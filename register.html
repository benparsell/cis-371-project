<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Downtown Theater">

    <title>Downtown Theater â€” Your local Movie Theater</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
        type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/landing-page.min.css" rel="stylesheet">

    <link href="css/styles.css" rel="stylesheet">

</head>

<body>
    <nav class="navbar navbar-light bg-light static-top">
        <div class="container">
            <a class="navbar-brand" href="index.html"><img src="img/logo.png" class="img-fluid logo" /> Downtown Theater</a>
        </div>
    </nav>
    <section id="gallery-intro" class="jumbotron">
        <div class="container">
            <div class="row">
                <h1>Create New Account</h1>
            </div>
        </div>
    </section>
    <div id="newAccount">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label id="fID">First Name</label>
              <input class="form-control" id="first_name" name="first_name" type="text" />
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label id="lID">Last Name</label>
              <input class="form-control" id="last_name" name="last_name" type="text" />
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label id="eID">Email</label>
              <input class="form-control" type="text" id="email" name="email" />
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label id="pID">Password</label>
              <input class="form-control" type="password" id="pass" name="password" />
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label id="rID">Password</label>
              <input class="form-control" type="password" id="repass" name="repass" />
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label id="aID">Address</label>
              <input class="form-control" type="text" id="address" name="address" />
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <div class="col-md-4">
              <br />
              <input class="btn btn-primary" type="button" value="Create Account" onclick="createAccount()">
            </div>
          </div>
        </div>
      </div>
    </div>
</body>
<!-- Footer -->
<footer class="footer bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 h-100 text-center text-lg-left my-auto">
                <ul class="list-inline mb-2">
                    <li class="list-inline-item">
                        <a href="#">About</a>
                    </li>
                    <li class="list-inline-item">&sdot;</li>
                    <li class="list-inline-item">
                        <a href="#">Contact</a>
                    </li>
                    <li class="list-inline-item">&sdot;</li>
                    <li class="list-inline-item">
                        <a href="#">Terms of Use</a>
                    </li>
                    <li class="list-inline-item">&sdot;</li>
                    <li class="list-inline-item">
                        <a href="#">Privacy Policy</a>
                    </li>
                </ul>
                <p class="text-muted small mb-4 mb-lg-0">&copy; Downtown Theater 2018. All Rights Reserved.</p>
            </div>
            <div class="col-lg-6 h-100 text-center text-lg-right my-auto">
                <ul class="list-inline mb-0">
                    <li class="list-inline-item mr-3">
                        <a href="#">
                            <i class="fab fa-facebook fa-2x fa-fw"></i>
                        </a>
                    </li>
                    <li class="list-inline-item mr-3">
                        <a href="#">
                            <i class="fab fa-twitter-square fa-2x fa-fw"></i>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">
                            <i class="fab fa-instagram fa-2x fa-fw"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>

<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDKChk9CActHlMIajRjHl9LAgjL3DHxHgc",
        authDomain: "cis-371-project.firebaseapp.com",
        databaseURL: "https://cis-371-project.firebaseio.com",
        projectId: "cis-371-project",
        storageBucket: "cis-371-project.appspot.com",
        messagingSenderId: "580346306494"
    };
    firebase.initializeApp(config);

    var ref = firebase.database().ref("customers")

    async function createAccount() {
        var fname = document.getElementById("first_name").value;
        var lname = document.getElementById("last_name").value;
        var email = document.getElementById("email").value;
        var password = document.getElementById("pass").value;
        var retyped = document.getElementById("repass").value;
        var address = document.getElementById("address").value;
        var length = 0;

        if(fname==="" || lname==="" || email==="" || password==="" || retyped==="" || address===""){
            window.alert("Error: One or more fields are missing.")
            if(fname===""){
                document.getElementById("fID").style.color = "red";
            }
            else{
                document.getElementById("fID").style.color = "black";
            }
            if(lname===""){
                document.getElementById("lID").style.color = "red";
            }
            else{
                document.getElementById("lID").style.color = "black";
            }
            if(email===""){
                document.getElementById("eID").style.color = "red";
            }
            else{
                document.getElementById("eID").style.color = "black";
            }
            if(password===""){
                document.getElementById("pID").style.color = "red";
            }
            else{
                document.getElementById("pID").style.color = "black";
            }
            if(retyped===""){
                document.getElementById("rID").style.color = "red";
            }
            else{
                document.getElementById("rID").style.color = "black";
            }
            if(address===""){
                document.getElementById("aID").style.color = "red";
            }
            else{
                document.getElementById("aID").style.color = "black";
            }
        }
        else{
            fname = fname.charAt(0).toUpperCase() + fname.substr(1).toLowerCase();
            lname = lname.charAt(0).toUpperCase() + lname.substr(1).toLowerCase();
            if(password == retyped){
                if(email.indexOf('@') > -1 && email.indexOf('.') > -1){
                    this.handleSignUp();
                    //window.alert("Thank You for Creating Your New Account! You Will Now Be Redirected to Our Homepage.")
                    //location.href='index.html';
                }
                else{
                    window.alert("Error: Email is not in a valid format");
                    document.getElementById("eID").style.color = "red";
                    document.getElementById("pID").style.color = "black";
                    document.getElementById("rSID").style.color = "black";
                }
            }
            else{
                window.alert("Error: Passwords do not match");
                document.getElementById("pID").style.color = "red";
                document.getElementById("rID").style.color = "red";
                document.getElementById("fID").style.color = "black";
                document.getElementById("lID").style.color = "black";
                document.getElementById("aID").style.color = "black";
            }
            //check name format, email, passwords are the same, addresss
            //if all match, push new customer; assign customer id
        }
    }

    /**
     * Handles the sign up button press.
     */
    function handleSignUp() {
      var email = document.getElementById('email').value;
      var password = document.getElementById('pass').value;
      if (email.length < 4) {
        alert('Please enter an email address.');
        return;
      }
      if (password.length < 4) {
        alert('Please enter a password.');
        return;
      }
      // Sign in with email and pass.
      // [START createwithemail]
      firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // [START_EXCLUDE]
        if (errorCode == 'auth/weak-password') {
          alert('The password is too weak.');
        } else {
          alert(errorMessage);
        }
        console.log(error);
        // [END_EXCLUDE]
      }).then(function () {
        this.signUpCallback(firebase.auth().currentUser.uid);
      });

      // [END createwithemail]
    }

    function signUpCallback(uID, email) {
      var address = document.getElementById("address").value;
      var email = document.getElementById("email").value;
      var first_name = document.getElementById("first_name").value;
      var last_name = document.getElementById("last_name").value;

      firebase.database().ref('customers/' + uID).set({
        address: address,
        custID: uID,
        email: email,
        firstName: first_name,
        lastName: last_name
      }).then(function () {
        window.location = "index.html";
      });
    }
</script>

</html>
